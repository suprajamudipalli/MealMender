<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thank You · MealMender</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="modern-style.css">
  <style>
    .thank-you-container {
      min-height: 80vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .heart-animation {
      font-size: 8rem;
      color: #ef4444;
      animation: heartbeat 1.5s ease-in-out infinite;
      margin-bottom: 2rem;
    }
    
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      10%, 30% { transform: scale(0.9); }
      20%, 40%, 60%, 80% { transform: scale(1.1); }
      50%, 70% { transform: scale(1.05); }
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #10b981;
      position: absolute;
      animation: confetti-fall 3s linear infinite;
    }
    
    @keyframes confetti-fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    .impact-stats {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-radius: 1.5rem;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }
    
    .stat-item {
      padding: 1rem;
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      display: block;
    }
    
    .share-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: 2rem 0;
    }
    
    .share-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      color: white;
      text-decoration: none;
      transition: all 0.3s;
    }
    
    .share-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .share-btn.facebook { background: #1877f2; }
    .share-btn.twitter { background: #1da1f2; }
    .share-btn.whatsapp { background: #25d366; }
    .share-btn.linkedin { background: #0077b5; }
  </style>
</head>
<body>

  <!-- Navbar -->

  <div class="container">
    <div class="thank-you-container">
      <div class="col-lg-8 mx-auto">
        <!-- Heart Animation -->
        <div class="heart-animation">
          ❤️
        </div>
        
        <!-- Thank You Message (Dynamic based on role) -->
        <h1 class="display-3 fw-bold mb-3" style="color: #10b981;" id="thank-you-title">
          Thank You for Making a Difference!
        </h1>
        
        <p class="lead text-muted mb-4" id="thank-you-message">
          Your contribution has helped reduce food waste and feed someone in need.
          Together, we're building a more sustainable and caring community.
        </p>
        
        <!-- Impact Stats -->
        <div class="impact-stats">
          <h3 class="mb-4">Your Impact Today</h3>
          <div class="row">
            <div class="col-md-4 stat-item">
              <span class="stat-number" id="meals-saved">1</span>
              <span>Meal Saved</span>
            </div>
            <div class="col-md-4 stat-item">
              <span class="stat-number" id="co2-saved">0.5</span>
              <span>kg CO₂ Prevented</span>
            </div>
            <div class="col-md-4 stat-item">
              <span class="stat-number" id="people-helped">1</span>
              <span>Person Helped</span>
            </div>
          </div>
        </div>
        
        <!-- Share Section -->
        <div class="mt-5">
          <h4 class="mb-3">Share Your Good Deed</h4>
          <p class="text-muted mb-3">Inspire others to join the movement against food waste!</p>
          
          <div class="share-buttons">
            <a href="#" class="share-btn facebook" onclick="shareOnFacebook()" title="Share on Facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="share-btn twitter" onclick="shareOnTwitter()" title="Share on Twitter">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="share-btn whatsapp" onclick="shareOnWhatsApp()" title="Share on WhatsApp">
              <i class="fab fa-whatsapp"></i>
            </a>
            <a href="#" class="share-btn linkedin" onclick="shareOnLinkedIn()" title="Share on LinkedIn">
              <i class="fab fa-linkedin-in"></i>
            </a>
          </div>
        </div>
        
        <!-- Action Buttons (Dynamic based on role) -->
        <div class="mt-5 d-flex gap-3 justify-content-center flex-wrap" id="action-buttons">
          <!-- Buttons will be dynamically loaded -->
        </div>
        
        <!-- Additional Message -->
        <div class="mt-5 p-4 bg-light rounded-3">
          <h5 class="mb-3">
            <i class="fas fa-lightbulb text-warning me-2"></i>
            Did You Know?
          </h5>
          <p class="text-muted mb-0">
            Every year, 1.3 billion tons of food is wasted globally. By sharing just one meal,
            you're part of the solution to this massive problem. Thank you for being a hero!
          </p>
        </div>
        
        <!-- Testimonial (Dynamic based on role) -->
        <div class="mt-4 p-4 border-start border-5 border-success bg-white rounded" id="testimonial-section">
          <!-- Testimonial will be dynamically loaded -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="config.js"></script>
  <script src="nav.js"></script>
  <script>
    if (typeof window.API_BASE_URL === 'undefined') {
      window.API_BASE_URL = 'http://localhost:5000';
    }

    const urlParams = new URLSearchParams(window.location.search);
    const requestId = urlParams.get('requestId');
    const token = localStorage.getItem('authToken');
    let currentUser = null;
    let requestData = null;

    document.addEventListener('DOMContentLoaded', async () => {
      createConfetti();
      await loadCurrentUser();
      if (requestId && token) {
        await loadImpactStats();
      }
    });

    async function loadCurrentUser() {
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/profile/me`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
          currentUser = await response.json();
        }
      } catch (error) {
        console.error('Error loading user:', error);
      }
    }

    function createConfetti() {
      const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6'];
      const confettiCount = 50;
      
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        document.body.appendChild(confetti);
        
        // Remove after animation
        setTimeout(() => confetti.remove(), 5000);
      }
    }

    async function loadImpactStats() {
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/requests/${requestId}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (response.ok) {
          requestData = await response.json();
          updateStats(requestData);
          updateContentBasedOnRole(requestData);
        }
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    function updateContentBasedOnRole(request) {
      const isDonor = currentUser && currentUser._id === request.donor?._id;
      
      if (isDonor) {
        // Donor content
        document.getElementById('thank-you-title').textContent = 'Thank You for Your Generous Donation!';
        document.getElementById('thank-you-message').textContent = 
          'Your kindness has made a real difference! By sharing your food, you\'ve helped reduce waste and brought joy to someone in need. You\'re a true hero in the fight against hunger and food waste.';
        
        document.getElementById('action-buttons').innerHTML = `
          <button class="btn btn-success btn-lg" onclick="window.location.href='donation.html'">
            <i class="fas fa-heart me-2"></i>Donate More Food
          </button>
          <button class="btn btn-primary btn-lg" onclick="window.location.href='dashboard.html'">
            <i class="fas fa-home me-2"></i>Go to Dashboard
          </button>
          <button class="btn btn-outline-secondary btn-lg" onclick="window.location.href='my_donations.html'">
            <i class="fas fa-gift me-2"></i>My Donations
          </button>
        `;
        
        document.getElementById('testimonial-section').innerHTML = `
          <p class="fst-italic mb-2">
            "Thank you so much for the delicious food! Your generosity means the world to me and my family."
          </p>
          <small class="text-muted">- A grateful recipient</small>
        `;
      } else {
        // Recipient content
        document.getElementById('thank-you-title').textContent = 'Thank You for Receiving!';
        document.getElementById('thank-you-message').textContent = 
          'We hope the food was fresh and delicious! By accepting this donation, you\'ve helped prevent food waste and supported our community. Together, we\'re building a more sustainable future.';
        
        document.getElementById('action-buttons').innerHTML = `
          <button class="btn btn-success btn-lg" onclick="window.location.href='receiver_improved.html'">
            <i class="fas fa-search me-2"></i>Browse More Food
          </button>
          <button class="btn btn-primary btn-lg" onclick="window.location.href='dashboard.html'">
            <i class="fas fa-home me-2"></i>Go to Dashboard
          </button>
          <button class="btn btn-outline-secondary btn-lg" onclick="window.location.href='my_requests.html'">
            <i class="fas fa-list me-2"></i>My Requests
          </button>
        `;
        
        document.getElementById('testimonial-section').innerHTML = `
          <p class="fst-italic mb-2">
            "It feels amazing to help reduce food waste while helping those in need. Every donation counts!"
          </p>
          <small class="text-muted">- A generous donor</small>
        `;
      }
    }

    function updateStats(request) {
      // Parse quantity
      const qtyMatch = request.requestedQuantity?.match(/\d+/);
      const meals = qtyMatch ? parseInt(qtyMatch[0]) : 1;
      
      document.getElementById('meals-saved').textContent = meals;
      document.getElementById('co2-saved').textContent = (meals * 0.5).toFixed(1);
      document.getElementById('people-helped').textContent = 1;
    }

    function shareOnFacebook() {
      const url = encodeURIComponent(window.location.origin);
      const text = encodeURIComponent('I just helped reduce food waste and feed someone in need through MealMender! Join me in making a difference. 🌍❤️');
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
    }

    function shareOnTwitter() {
      const url = encodeURIComponent(window.location.origin);
      const text = encodeURIComponent('I just helped reduce food waste and feed someone in need through MealMender! Join me in making a difference. 🌍❤️ #FoodWaste #Sustainability');
      window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
    }

    function shareOnWhatsApp() {
      const text = encodeURIComponent('I just helped reduce food waste and feed someone in need through MealMender! Check it out: ' + window.location.origin);
      window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    function shareOnLinkedIn() {
      const url = encodeURIComponent(window.location.origin);
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
    }
  </script>
</body>
</html>
